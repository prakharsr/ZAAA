<mat-toolbar>  
  <mat-toolbar-row>
    <div class="container">Edit Firm Profile</div>
  </mat-toolbar-row>
</mat-toolbar>

<br>

<div class="container">
  <form (ngSubmit)="submit()" #profileForm="ngForm">
    <mat-accordion>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Business Details</mat-panel-title>
          <mat-panel-description>Enter Business details</mat-panel-description>
        </mat-expansion-panel-header>

        <button mat-icon-button (click)="agencyDetailsEdit = true">edit</button> 

        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" [disabled]="!agencyDetailsEdit" type="text" name="firmName" placeholder="Firm Name" [(ngModel)]="profile.name" required #firmNameField="ngModel">
          <mat-error *ngIf="firmNameField.errors && firmNameField.errors.required">
            Firm Name is required.
          </mat-error>
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" type="text" name="tagline" placeholder="Tagline" [(ngModel)]="profile.tagline" #taglineField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" type="text" name="nickname" placeholder="Nickname" [(ngModel)]="profile.nickname" #nicknameField="ngModel">
        </mat-form-field>

        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" [matDatepicker]="incDateField" name="incDate" placeholder="Incorporation Date" [(ngModel)]="profile.incDate" disabled>
          <mat-datepicker-toggle matSuffix [for]="incDateField"></mat-datepicker-toggle>
          <mat-datepicker #incDateField disabled="false"></mat-datepicker>
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" type="text" name="website" placeholder="Website" [(ngModel)]="profile.website" #websiteField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!agencyDetailsEdit" type="text" name="panNo" placeholder="PAN Number" [(ngModel)]="profile.panNo" minlength="10" maxlength="10" required #panNoField="ngModel">
          <mat-error *ngIf="panNoField.errors && panNoField.errors.required">
            PAN Number is required.
          </mat-error>
          <mat-error *ngIf="panNoField.errors && (panNoField.errors.minlength || panNoField.errors.maxlength)">
            PAN Number should be 10 characters long.
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <div class="{{profile.GSTIN.GSTType != 'URD' ? 'col-auto' : 'col'}}">
            <mat-form-field>
              <mat-select placeholder="GST Type" name="gstType" [(ngModel)]="profile.GSTIN.GSTType">
                <mat-option value="URD">URD</mat-option>
                <mat-option value="RD">RD</mat-option>
                <mat-option value="CRD">CRD</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col" *ngIf="profile.GSTIN.GSTType != 'URD'">
            <mat-form-field>
              <input matInput [disabled]="!agencyDetailsEdit" type="text" name="gstNo" placeholder="GST Number" [(ngModel)]="profile.GSTIN.GSTNo" required minlength="15" maxlength="15" #gstNoField="ngModel">
              <mat-error *ngIf="gstNoField.errors && gstNoField.errors.required">
                GSTIN is required.
              </mat-error>
              <mat-error *ngIf="gstNoField.errors && (gstNoField.errors.minlength || gstNoField.errors.maxlength)">
                GSTIN should be 15 characters long.
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Contact Details</mat-panel-title>
          <mat-panel-description>Enter Contact Details</mat-panel-description>
        </mat-expansion-panel-header>

        <div class="form-row">
          <div class="col">
            <mat-form-field>
              <input matInput [disabled]="!contactDetailsEdit" type="email" name="email" placeholder="Email" [(ngModel)]="profile.email" required #emailField="ngModel" verify-email>
              <mat-error *ngIf="emailField.errors && emailField.errors.required">
                Email is required.
              </mat-error>
              <mat-error *ngIf="emailField.errors && emailField.errors.email">
                Invalid Email.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-auto align-self-center">
            <button class="btn btn-sm btn-outline-info" type="button" (click)="profile.email = user.email">Copy from User</button>
          </div>
        </div>
    
        <mat-form-field>
          <span matPrefix>+91 &nbsp;</span>
          <input matInput [disabled]="!contactDetailsEdit" type="tel" [(ngModel)]="profile.phone" pattern="^\d{10}$" maxlength="10" minlength="10" name="phone" placeholder="Mobile 1" #phoneField="ngModel">
          <mat-error *ngIf="phoneField.errors">
            Mobile 1 is empty or invalid.
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <span matPrefix>+91 &nbsp;</span>
          <input matInput [disabled]="!contactDetailsEdit" type="tel" [(ngModel)]="profile.OtherMobile" pattern="^\d{10}$" maxlength="10" minlength="10" name="phone2" placeholder="Mobile 2" #phone2Field="ngModel">
          <mat-error *ngIf="phone2Field.errors">
            Mobile 2 is invalid.
          </mat-error>
        </mat-form-field>

        <div class="form-row">
          <div class="col-3">
            <mat-form-field>
              <input matInput [disabled]="!contactDetailsEdit" type="tel" name="stdNo" placeholder="STD No" minlength="3" maxlength="5" [(ngModel)]="profile.stdNo" #stdNoField="ngModel">
            </mat-form-field>
          </div>
      
          <div class="col-9">
            <mat-form-field>
              <input matInput [disabled]="!contactDetailsEdit" type="tel" name="landlineNo" minlength="6" maxlength="8" placeholder="Landline Number" [(ngModel)]="profile.landlineNo" #landlineNoField="ngModel">
            </mat-form-field>
          </div>
        </div>        
      
        <mat-form-field>
          <input matInput [disabled]="!contactDetailsEdit" type="number" name="fax" placeholder="Fax" [(ngModel)]="profile.fax" #faxField="ngModel">
        </mat-form-field>
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Registered Address</mat-panel-title>
          <mat-panel-description>Enter Registered Address</mat-panel-description>
        </mat-expansion-panel-header>

        <mat-form-field>
          <input matInput [disabled]="!registeredDetailsEdit" type="text" name="registeredAddress" placeholder="Registered Address" [(ngModel)]="profile.registeredAddress.address" required #registeredAddressField="ngModel">
          <mat-error *ngIf="firmNameField.errors && firmNameField.errors.required">
            Registered Address is required.
          </mat-error>
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!registeredDetailsEdit" type="tel" minlength="6" maxlength="6" name="registeredPincode" placeholder="Pincode" [(ngModel)]="profile.registeredAddress.pincode" required #registeredPincodeField="ngModel">
          <mat-error *ngIf="registeredPincodeField.errors && registeredPincodeField.errors.required">
            Pincode is required.
          </mat-error>
          <mat-error *ngIf="registeredPincodeField.errors && (registeredPincodeField.errors.minlength || registeredPincodeField.errors.maxlength)">
            Pincode should be 6 characters long.
          </mat-error>
        </mat-form-field>
        
        <mat-form-field>
          <input matInput [disabled]="!registeredDetailsEdit" type="text" name="registeredCity" placeholder="City" [(ngModel)]="profile.registeredAddress.city" required #registeredCityField="ngModel">
          <mat-error *ngIf="registeredCityField.errors && registeredCityField.errors.required">
            City is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-select [disabled]="!registeredDetailsEdit" placeholder="State" name="registeredState" [(ngModel)]="profile.registeredAddress.state" required #registeredStateField="ngModel">
            <mat-option *ngFor="let state of stateApi.states" [value]="state">{{state}}</mat-option>
          </mat-select>
          <mat-error *ngIf="registeredStateField.errors && registeredStateField.errors.required">
            State is required.
          </mat-error>
        </mat-form-field>
      
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Office Address</mat-panel-title>
          <mat-panel-description>Enter Office Address</mat-panel-description>
        </mat-expansion-panel-header>

        <button type="button" mat-raised-button (click)="copyAddress()">Copy from Registered Details</button>
        <br><br>

        <mat-form-field>
          <input matInput [disabled]="!officeDetailsEdit" type="text" name="officeAddress" placeholder="Office Address" [(ngModel)]="profile.officeAddress.address" #officeAddressField="ngModel">
        </mat-form-field>

        <mat-form-field>
          <input matInput [disabled]="!officeDetailsEdit" type="tel" minlength="6" maxlength="6" name="officePincode" placeholder="Pincode" [(ngModel)]="profile.officeAddress.pincode" #officePincodeField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!officeDetailsEdit" type="text" name="officeCity" placeholder="City" [(ngModel)]="profile.officeAddress.city" #officeCityField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <mat-select [disabled]="!officeDetailsEdit" placeholder="State" name="officeState" [(ngModel)]="profile.officeAddress.state" #officeStateField="ngModel">
            <mat-option *ngFor="let state of stateApi.states" [value]="state">{{state}}</mat-option>
          </mat-select>
          <mat-error *ngIf="officeStateField.errors && officeStateField.errors.required">
            State is required.
          </mat-error>
        </mat-form-field>
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Bank Account Details</mat-panel-title>
          <mat-panel-description>Enter Bank Account Details</mat-panel-description>
        </mat-expansion-panel-header>

        <div class="form-row">
          <div class="col">
            <mat-form-field>
              <input matInput [disabled]="!bankDetailsEdit" type="text" name="bankAccountName" placeholder="Bank Account Name" [(ngModel)]="profile.bankAccountName" required #bankAccountNameField="ngModel">
              <mat-error *ngIf="bankAccountNameField.errors && bankAccountNameField.errors.required">
                Account Name is required.
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-auto align-self-center">
            <button class="btn btn-sm btn-outline-info" type="button" (click)="profile.bankAccountName = profile.name">Copy Firm Name</button>
          </div>
        </div>
      
        <mat-form-field>
          <input matInput [disabled]="!bankDetailsEdit" type="text" name="bankAccountNo" placeholder="Bank Account Number" [(ngModel)]="profile.bankAccountNo" required #bankAccountNoField="ngModel">
          <mat-error *ngIf="bankAccountNoField.errors && bankAccountNoField.errors.required">
            Account Number is required.
          </mat-error>
        </mat-form-field>
    
        <mat-form-field>
          <input matInput [disabled]="!bankDetailsEdit" type="text" name="bankIfsc" placeholder="Bank IFSC" [(ngModel)]="profile.bankIfsc" required minlength="11" maxlength="11" #bankIfscField="ngModel" (input)="ifscChanged()">
          <mat-error *ngIf="bankIfscField.errors && bankIfscField.errors.required">
            IFSC is required.
          </mat-error>
          <mat-error *ngIf="bankIfscField.errors && (bankIfscField.errors.minlength || bankIfscField.errors.maxlength)">
            IFSC should be 11 characters long.
          </mat-error>
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!bankDetailsEdit" type="text" name="bankName" placeholder="Bank Name" [(ngModel)]="profile.bankName" required #bankNameField="ngModel">
          <mat-error *ngIf="bankNameField.errors && bankNameField.errors.required">
            Bank Name is required.
          </mat-error>
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!bankDetailsEdit" type="text" name="bankBranchAddress" placeholder="Bank Branch Address" [(ngModel)]="profile.bankBranchAddress" required #bankBranchAddressField="ngModel">
          <mat-error *ngIf="bankBranchAddressField.errors && bankBranchAddressField.errors.required">
            Bank Branch Address is required.
          </mat-error>
        </mat-form-field>
      
        <mat-form-field>
          <mat-select [disabled]="!bankDetailsEdit" placeholder="Bank Account Type" name="bankAccountType" [(ngModel)]="profile.bankAccountType">
            <mat-option value="Current">Current</mat-option>
            <mat-option value="Savings">Savings</mat-option>
          </mat-select>
        </mat-form-field>
      </mat-expansion-panel>
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Social Details</mat-panel-title>
          <mat-panel-description>Enter Social Details</mat-panel-description>
        </mat-expansion-panel-header>

        <mat-form-field>
          <input matInput [disabled]="!socialDetailsEdit" type="text" name="facebook" placeholder="Facebook Link" [(ngModel)]="profile.facebook" #facebookField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!socialDetailsEdit" type="text" name="twitter" placeholder="Twitter Link" [(ngModel)]="profile.twitter" #twitterField="ngModel">
        </mat-form-field>
      
        <mat-form-field>
          <input matInput [disabled]="!socialDetailsEdit" type="text" name="others" placeholder="Other social Link" [(ngModel)]="profile.other" #otherField="ngModel">
        </mat-form-field>
      </mat-expansion-panel>
    </mat-accordion>

    <br><br>
  
    <button type="submit" class="btn btn-success" [disabled]="!profileForm.form.valid">Save</button>
    <button type="button" class="btn btn-danger" (click)="cancel()">Cancel</button>

    <br><br><br>
  </form>
</div>